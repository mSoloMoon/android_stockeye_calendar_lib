apply plugin: 'java'
//apply from: 'cobertura.gradle'
apply plugin: "jacoco"

version = 0.1

repositories {
	mavenCentral()
}
dependencies {
	testCompile 'junit:junit:4.11'
  codeCoverage 'org.jacoco:org.jacoco.agent:0.5.10.201208310627:runtime@jar'
  codeCoverageAnt 'org.jacoco:org.jacoco.ant:0.5.10.201208310627'
}

task libJavadocs(type: Javadoc) {
	source = sourceSets.main.allJava
}

configurations {
  codeCoverage
  codeCoverageAnt
}

test {
  systemProperties = System.properties
  jvmArgs "-javaagent:${configurations.codeCoverage.asPath}=destfile=${project.buildDir.path}/coverage-results/jacoco.exec,sessionid=HSServ,append=false",
  '-Djacoco=true',
  '-Xms128m',
  '-Xmx512m',
  '-XX:MaxPermSize=128m'
}

task generateCoverageReport << {
  ant {
    taskdef(name:'jacocoreport', classname: 'org.jacoco.ant.ReportTask', classpath: configurations.codeCoverageAnt.asPath)

    mkdir dir: "build/reports/coverage"

    jacocoreport {
      executiondata {
        fileset(dir: "build/coverage-results") {
          include name: 'jacoco.exec'
        }
      }
      structure(name: project.name) {
        classfiles {
          fileset(dir: "build/classes/main") {
            exclude name: 'org/ifxforum/**/*'
            exclude name: 'org/gca/euronet/generated**/*'
          }
        }
        sourcefiles(encoding: 'CP1252') {
          fileset dir: "src/main/java"
        }
      }

      xml destfile: "build/reports/coverage/jacoco.xml"
      html destdir: "build/reports/coverage"
    }
  }
}
